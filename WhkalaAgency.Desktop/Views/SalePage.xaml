<UserControl x:Class="WhkalaAgency.Desktop.Views.SalesPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             FlowDirection="RightToLeft">

    <UserControl.Resources>
        <Style x:Key="CardBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="14"/>
            <Setter Property="BorderBrush" Value="#E6EBF2"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="18"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="18" Opacity="0.08" ShadowDepth="2" Color="#1E2A3A"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="FieldTextBoxStyle" TargetType="TextBox">
            <Setter Property="Height" Value="40"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="10,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="#FAFCFF"/>
            <Setter Property="BorderBrush" Value="#D8E2EF"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style x:Key="FieldComboStyle" TargetType="ComboBox">
            <Setter Property="Height" Value="40"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="8,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="#FAFCFF"/>
            <Setter Property="BorderBrush" Value="#D8E2EF"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style x:Key="SectionLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#4B5A70"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>
    </UserControl.Resources>

    <Grid Background="#F2F6FB">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Margin="26,20,26,14" Padding="24,18" CornerRadius="16">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#1E3A8A" Offset="0"/>
                    <GradientStop Color="#1D4ED8" Offset="0.55"/>
                    <GradientStop Color="#2563EB" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                    <TextBlock Text="فاتورة مبيعات مجمعة" FontSize="31" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="إدارة مبيعات التجار وتوزيع مستحقات المزارعين"
                               FontSize="14"
                               Margin="0,6,0,0"
                               Foreground="#D6E4FF"/>
                </StackPanel>

                <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                    <TextBlock Text="تاريخ الفاتورة" Foreground="#D6E4FF" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <DatePicker x:Name="DtSaleDate" Width="170" Height="38"/>
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Row="1" Margin="26,0,26,14" Style="{StaticResource CardBorderStyle}">
            <StackPanel>
                <UniformGrid Columns="3" Margin="0,0,0,10">
                    <StackPanel Margin="0,0,10,0">
                        <TextBlock Text="التاجر (المشتري)" Style="{StaticResource SectionLabelStyle}"/>
                        <ComboBox x:Name="CboTraders" DisplayMemberPath="Name" SelectedValuePath="Id" Style="{StaticResource FieldComboStyle}"/>
                    </StackPanel>

                    <StackPanel Margin="0,0,10,0">
                        <TextBlock Text="المزارع (صاحب البضاعة)" Style="{StaticResource SectionLabelStyle}"/>
                        <ComboBox x:Name="CboFarmers" DisplayMemberPath="Name" SelectedValuePath="Id" Style="{StaticResource FieldComboStyle}"/>
                    </StackPanel>

                    <StackPanel>
                        <TextBlock Text="الصنف المباع" Style="{StaticResource SectionLabelStyle}"/>
                        <ComboBox x:Name="CboProducts" DisplayMemberPath="Name" SelectedValuePath="Id" Style="{StaticResource FieldComboStyle}"/>
                    </StackPanel>
                </UniformGrid>

                <Grid Margin="0,4,0,14">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1.1*"/>
                        <ColumnDefinition Width="1.1*"/>
                        <ColumnDefinition Width="1.1*"/>
                        <ColumnDefinition Width="1.3*"/>
                        <ColumnDefinition Width="1.1*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,10,0">
                        <TextBlock Text="الكمية" Style="{StaticResource SectionLabelStyle}"/>
                        <TextBox x:Name="TxtQuantity" Style="{StaticResource FieldTextBoxStyle}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="0,0,10,0">
                        <TextBlock Text="الوزن القائم" Style="{StaticResource SectionLabelStyle}"/>
                        <TextBox x:Name="TxtGrossWeight" TextChanged="CalculateWeights" Style="{StaticResource FieldTextBoxStyle}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Margin="0,0,10,0">
                        <TextBlock Text="وزن الفارغ" Style="{StaticResource SectionLabelStyle}"/>
                        <TextBox x:Name="TxtTareWeight" TextChanged="CalculateWeights" Style="{StaticResource FieldTextBoxStyle}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="3" Margin="0,0,10,0">
                        <TextBlock Text="صافي الوزن" FontSize="12" FontWeight="Bold" Margin="0,0,0,6" Foreground="#1D4E89"/>
                        <TextBox x:Name="TxtNetWeight" IsReadOnly="True" FontWeight="Bold" Style="{StaticResource FieldTextBoxStyle}" Background="#EEF6FF" BorderBrush="#B9D6F7"/>
                    </StackPanel>

                    <StackPanel Grid.Column="4">
                        <TextBlock Text="سعر الوحدة" Style="{StaticResource SectionLabelStyle}"/>
                        <TextBox x:Name="TxtPrice" Style="{StaticResource FieldTextBoxStyle}"/>
                    </StackPanel>
                </Grid>

                <Button Content="إضافة الصنف للقائمة"
                        Click="BtnAddToBasket_Click"
                        Height="42"
                        FontSize="14"
                        FontWeight="Bold"
                        Background="#2563EB"
                        Foreground="White"
                        BorderThickness="0"/>

                <Border Margin="0,12,0,10" CornerRadius="10" BorderBrush="#E5ECF6" BorderThickness="1">
                    <DataGrid x:Name="BasketGrid"
                              AutoGenerateColumns="False"
                              Height="130"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              GridLinesVisibility="None"
                              HeadersVisibility="Column"
                              RowHeight="38"
                              BorderThickness="0"
                              Background="White">
                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#F7FAFE"/>
                                <Setter Property="Foreground" Value="#42526A"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Padding" Value="12,10"/>
                                <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                <Setter Property="BorderBrush" Value="#E3EAF3"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="المزارع" Binding="{Binding FarmerName}" Width="*"/>
                            <DataGridTextColumn Header="الصنف" Binding="{Binding ProductName}" Width="*"/>
                            <DataGridTextColumn Header="الصافي" Binding="{Binding NetWeight}" Width="90"/>
                            <DataGridTextColumn Header="الإجمالي" Binding="{Binding TotalAmount, StringFormat={}{0:N2}}" Width="110"/>
                            <DataGridTemplateColumn Header="" Width="70">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="حذف"
                                                Foreground="#C53030"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                Click="RemoveFromBasket_Click"
                                                FontSize="12"
                                                Cursor="Hand"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left">
                        <TextBlock Text="الدفع" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,10,0" Foreground="#4B5A70"/>
                        <ComboBox x:Name="CboPaymentType" Width="120" Height="36" SelectedIndex="0">
                            <ComboBoxItem Content="نقدي" Tag="Cash"/>
                            <ComboBoxItem Content="آجل" Tag="Credit"/>
                        </ComboBox>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                        <TextBlock Text="الإجمالي" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="#4B5A70"/>
                        <Border Background="#ECFDF3" CornerRadius="12" Padding="12,6" Margin="0,0,12,0">
                            <TextBlock x:Name="LblGrandTotal" Text="0.00 ج.م" FontSize="20" FontWeight="Bold" Foreground="#1F8A5B"/>
                        </Border>
                        <Button Content="ترحيل الفاتورة"
                                Click="BtnSaveSale_Click"
                                Width="145"
                                Height="42"
                                Background="#16A34A"
                                Foreground="White"
                                FontWeight="Bold"
                                BorderThickness="0"/>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Border>

        <Border Grid.Row="2" Margin="26,0,26,22" Style="{StaticResource CardBorderStyle}" Padding="0" ClipToBounds="True">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Background="#F7FAFE" BorderBrush="#E3EAF3" BorderThickness="0,0,0,1" Padding="16,12">
                    <TextBlock Text="سجل المبيعات الأخير" FontWeight="SemiBold" Foreground="#42526A"/>
                </Border>

                <DataGrid x:Name="SalesGrid"
                          Grid.Row="1"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          HeadersVisibility="Column"
                          GridLinesVisibility="None"
                          RowHeight="40"
                          BorderThickness="0"
                          Background="White"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Auto">

                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="#F7FAFE"/>
                            <Setter Property="Foreground" Value="#42526A"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="Padding" Value="14,12"/>
                            <Setter Property="BorderThickness" Value="0,0,0,1"/>
                            <Setter Property="BorderBrush" Value="#E3EAF3"/>
                        </Style>
                    </DataGrid.ColumnHeaderStyle>

                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="White"/>
                            <Setter Property="BorderBrush" Value="#EEF2F7"/>
                            <Setter Property="BorderThickness" Value="0,0,0,1"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#F8FBFF"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="التاريخ" Binding="{Binding SaleDate}" Width="120"/>
                        <DataGridTextColumn Header="التاجر" Binding="{Binding TraderName}" Width="*"/>
                        <DataGridTextColumn Header="المزارع" Binding="{Binding FarmerName}" Width="*"/>
                        <DataGridTextColumn Header="الصنف" Binding="{Binding ProductName}" Width="*"/>
                        <DataGridTextColumn Header="الصافي" Binding="{Binding NetWeight}" Width="90"/>
                        <DataGridTextColumn Header="القيمة" Binding="{Binding TotalAmount, StringFormat={}{0:N2}}" Width="110"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
    </Grid>
</UserControl>
